// Code generated by xorm reverse.
// 同步表结构到数据库
package dbmodel


import "fmt"
import "xorm.io/xorm"

// InitSync 更新表结构到单库，用于测试和开发环境
// 快速同步表结构，以及dbdiff出表结构改动
func InitSync(orm *xorm.Engine) error {
    var err error
    {{range .Tables}}
    err = sync(orm, &{{TableMapper .Name}}{})
    if err != nil {
        fmt.Print(fmt.Errorf("sync &{{TableMapper .Name}} error:%v", err))
    }
    {{end}}

    return nil
}

// GetShardInfo 获取所有表的分区数量，大于1的都认为要分区
func GetShardInfo() map[string]int {
    info := make(map[string]int)
    {{range .Tables}}
    {{$table := .}}
    info["{{$table.Name}}"] = new({{TableMapper .Name}}).ShardNum()
    {{end}}
    return info
}

func sync(orm *xorm.Engine, table TableInterface) error {
    return orm.Sync2(table)
}
